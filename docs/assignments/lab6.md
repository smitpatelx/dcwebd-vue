# Lab 6 - Self-referring Forms w/ Data Validation

## General

This is a challenging assignment but contains some important concepts that will be used in subsequent assignments and tests. You are recommended not to put this assignment off until the last minute.

You are to create a **`lab6.php`** file, that is going to have an HTML form that refers the page back to itself and utilizes some PHP provided functions to handle data validation.

All this will be to the end of creating a dynamic temperature conversion table, based on users input.

A self-referring form with data validation has been provided for you (and was discussed in class), the content of the file can be found in [`lab6_lecture.txt`](../code_snippets/lab6_lecture.php). Take the contents of this file and place it in a new text file with a **`*.php`** extension, and you can see how it works.

<<< @\docs\.vuepress\public\code_snippets\lab6_lecture.php

## Due Date

The due date for Lab 6 is found on the [Important Dates](http://opentech.durhamcollege.org/pufferd/webd2201/importantdates) page and in DC Connect. This means that you must have published your website into your development folder on the opentech server and have submitted a clickable HTML link to your website on the opentech server in the Lab 6 assessment dropbox comment section in DC Connect (see "Submission" section).

You will be given a mark out of twenty (20). You will be told of the reasons for any loss of marks, these points are to be used as constructive criticism (i.e. fix the problems as a practice for the term tests).

## Specific Requirements

- You are to create a **`lab6.php`**, that is satisfies the requirements below.

* **`lab6.php`** page must be validated to the **_XHTML_** Strict standard.

* The file you are to create for this assignment should include your **`header.php`** (which will automatically incorporate your **`webd2201.css`** stylesheet) and **`footer.php`**. This will assure the new file conforms to your existing page layout. Be sure to include a link to the new **`lab6.php`** page in your header.php file, and a detailed paragraph describing what the page does/instructions for the data to be entered.

* Similar to previous assignments, include PHP (i.e. `/* c-style */`) comments with your name and course code in the **`lab6.php`** file created for this assignment. Additionally, add dynamic HTML comments to all your **`lab6.php`** page (this should occur if you implement your **`header.php`** file correctly).

* The **`lab6.php`** is a PHP page that:

  - Defines a constant named **`MAX_ITERATIONS`** that contains a value of 100.

  * Contains a **`self-referencing/self-submitting`** form(to achieve this the action attribute on the page's `<form>` tag should have `<?php echo $_SERVER['REQUEST_URI']; ?>` or `<?php echo $_SERVER['PHP_SELF']; ?>`)

  * The form should be submitted in POST mode

  * This page should, the first time the pages loads in the default GET mode, create empty string variables named `$start, $stop, $incr, $error and $output` (respectively used to store: the start temperature; the stop temperature; the temperature increment; any error messages generated by the data validation; and, the generated table output).
  * Has three (3) named text input boxes, one for a starting temperature, one for an ending temperature and one for the increment the user wants to increase the temperature by each.
  * When submitted in POST mode, should store the three (3) inputted values from the `$_POST[]` array in variables named `$start, $stop, and $incr`
    - Performs a check that the data submitted is valid. Valid data means:
    * That the user entered something in each field (i.e. they are not empty)
    * That the user entered numbers in each field
    * That the start temperature is less than the end temperature
    * That the temperature increment is a positive (non-zero) number
    * If all the above conditions are met, you should verify that there would not be more than `MAX_ITERATIONS` number of loops, based on the conditions set by the user. **NOTE: this can be determined by making sure that `($stop - $start)/$incr` is less than or equal to `MAX_ITERATIONS` (after all other data validation is completed)**

If any of these conditions are not met, an appropriate message should be placed in the `$error` variable and no calculation should be done or a table created, but the error message should be displayed. If any invalid data is entered, it should be incorporated as part of the error, but the variable subsequently should be emptied off of the form (i.e. set the variable that is `echo'ed` in the form input's value equal to ""). **NOTE: for full marks, your page MUST detect and display multiple errors (i.e. if a non-numeric input was entered for the start temperature AND nothing was entered for an increment BOTH issues should be flagged as a problem, this can be achieved by concatenating new errors to the end of the \$errors variable).**

- If there are no errors, then the page should create an `$output` variable that contains a table of temperature conversion (be sure to use the file that performs the calculation in a function), that uses the entered numbers and a loop.

* To see how the page should work check out the example provided.

::: tip NOTE
The form on the page should be "sticky", which means if vaild data was placed in the form, it will still be in the form when the page reloads. This can be achieved by echoing the variables from the `$_POST[]` array into the value attribute of the appropriate input box.
:::

## Rubric

<table  style="border:2px solid #41b07e;width:100%;">
<tr>
<td style="font-weight:bold;text-align: center;">Topic</td>
<td style="font-weight:bold;text-align: center;">Description</td>
<td style="font-weight:bold;text-align: center;">Weighting</td>
</tr>
<tr>
<td colspan = "3" style="text-align:center;">Submission</td>
</tr>
<tr>
<td><b>Submission</b></td>
<td><br/>-2 files not published into your <span class="em">/var/www/html/webd2201/userid</span> main folder (instead in <span class="em">/home/userid</span> folder).<br/><br/>
-2 no link submitted in DC Connect <span class="em">Lab 6</span> assignment drop box<br/><br/>
-1 link in DC Connect <span class="em">Lab 6</span> assignment drop box not clickable<br/><br/>
-1 link in DC Connect <span class="em">Lab 6</span> assignment drop box does not go to your website<br/><br/></td>
<td style="text-align:center;"><b>/2</b></td>
</tr>
<tr>
<td colspan = "3" style="text-align:center;">Deliverable Specific Outcomes</td>
</tr>
<tr>
<td><b>Comments/Description paragraphs</b></td>
<td><br/>-3 <span class="code">&lt;!-- HTML Comments --&gt;</span> are not dynamic (i.e. hard-coded once and/or do not <span class="code">echo</span> declared variables (<span class="code">$file, $date, $desc, $title, $banner</span>) in the <span class="em">header.php</span> file.<br/><br/>
-2 dynamic <span class="code">&lt;!-- HTML Comments --&gt;</span> not <span class="code">echo</span>'ed in the <span class="em">header.php</span> file (implemented incorrectly)
<br/><br/>-2 <span class="em">lab6.php</span> missing description paragraph<br/><br/>
-1 <span class="em">lab6.php</span> description paragraph light on content/not very descriptive.<br/><br/>
-2 missing <code>/&#42; c-style &#42;/</code> comments on <em>lab6&#42;.php</em> page.<br/><br/></td>
<td style="text-align:center;"><b>/3</b></td>
</tr>
<tr>
<td><b><span class="em">lab6.php</span> Page</b></td>
<td><br/>-1 file not named <span class="em">lab6.php</span>.  
<br/><br/>-1 no link added in <span class="em">header.php</span> nav bar to link to new <span class="em">lab6.php</span> page.<br/><br/></td>
<td style="text-align:center;"><b>/2</b></td>
</tr>
<tr>
<td><b>Define/Use <code>MAX_ITERATIONS</code> constant </b></td>
<td><br/>-3 did not define <span class="code">MAX_ITERATIONS</span> constant or use it at all: <code>define("MAX_ITERATIONS", 100);</code>
<br/><br/>-1 did not set <code>MAX_ITERATIONS</code> to 100 when defining it: <code>define("MAX_ITERATIONS", 100);</code>
<br/><br/>-2 did not verify that <span class="code">($stop - $start)/$incr causes less than or exactly 100 iterations.</span><br/><br/>
-1 did not use <span class="code">MAX_ITERATIONS</span> in<br/> <span class="code">($stop - $start)/$incr &gt;= MAX_ITERATIONS</span>.<br/><br/>
-1 did not use <span class="code">MAX_ITERATIONS</span> in the error message for too many iterations (hard-coded the value)<br/><br/></td>
<td style="text-align:center;"><b>/3</b></td>
</tr>
<tr>
<td><b>Data Validation</b></td>
<td><br/>-1 did not verify the start temperature was not empty (that the user entered something).<br/><br/>
-1  did not verify the start temperature entered was a number using <code>is_numeric()</code> function.<br/><br/>
-1 did not verify the stop temperature was not empty (that the user entered something).<br/><br/>
-1  did not verify the stop temperature entered was a number using <code>is_numeric()</code> function.<br/><br/>
-1 did not verify the temperature increment was not empty (that the user entered something).<br/><br/>
-1  did not verify the temperature increment entered was a number using <code>is_numeric()</code> function.<br/><br/>
-1 when all input were verified as numbers, did not verify the stop temperature was greater than the start temperature<br/><br/>
-1 when all input were verified as numbers, did not verify the  temperature increment was a positive number<br/><br/>
-1 when all input were verified as numbers, did not verify the  temperature increment was not zero (0)<br/><br/></td>
<td style="text-align:center;"><b>/6</b></td>
</tr>
<tr>
<td><b>Error message and form "stickiness"</b></td>
<td><br/>-2 did not code separate <code>if...else</code> statements (one for each text input) to handle multiple errors per form submission<br/><br/>
-1 error message(s) are not specific (i.e. <em>You must enter a start temperature...</em> vs. <em>You must enter something into the text box.</em>)<br/><br/>
-1 error message(s) did not include invalid data as part of the output.<br/><br/>
-2 form is not "sticky" (i.e. valid data should remain on the form by <code>echo</code>ing variables into the <em>value</em> attribute of the appropriate text input element)><br/><br/>
-1 <code>$error</code> error message was not <code>echo</code>'ed above the form.<br/><br/>
-1 invalid data is not emptied off of the form.<br/><br/></td>
<td style="text-align:center;"><b>/3</b></td>
</tr>
<tr>
<td><b>Output generation and display</b></td>
<td><br/>-1 output genreated even if there are errors on the page.
<br/><br/>-2 no <code>$output</code> generated  using a <code>for...</code> loop (hard-coded output)<br/><br/>
-1 did not use string concatenation operator to add each temperature conversion from the for loop:<code>$output .= "&lt;tr&gt;&lt;td&gt;..."</code><br/><br/>
-0.5 no <code>&amp;deg;</code> symbol in the output.<br/><br/>
-1 <code>$output</code> variable was not <code>echo</code>'ed below the form.<br/><br/></td>
<td style="text-align:center;"><b>/2</b></td>
</tr>
<tr>
<td colspan = "3" style="text-align:center;">Other Penalties</td>
</tr>
<tr>
<td><b>XHTML Validation</b></td>
<td><br/>-1 no clickable XHTML image provided on <span class="em">lab6.php</span> page.
<br/><br/>-2 <code>&lt;!DOCTYPE&gt;</code> in <em>header.php</em> was not <code>Strict</code> (used <code>Transitional</code> or <code>HTML 4.01</code> instead)
<br/><br/>-1 exactly one XHTML error on <span class="em">lab6.php</span> page.
<br/><br/>-2 more than one XHTML error on <span class="em">lab6.php</span> page.<br/><br/></td>
<td style="text-align:center;"><b>-2</b><br/><p style='font-size:0.8em'>(-1.0 per incident, maximum 2 incidents)</p></td>
</tr>
<tr>
<td><b>Late Submission</b></td>
<td><br/>-0 lab submitted on time<br/><br/>
-5 lab submitted late but within 72 hours of due date<br/><br/>
-20 lab not submitted within 72 hours of due date<br/><br/></td>
<td style="text-align:center;"><b>/5</b></td>
</tr>
<tr>
<td><b><em>header.php</em> and <em>footer.php</em> Implementation</b></td>
<td><br/>-1 <span class="em">lab6.php</span> page does not implement <span class="em">header.php</span> 
<br/><br/>-1 <span class="em">lab6.php</span> page does not implement <span class="em">footer.php</span> files.<br/><br/>
</td>
<td style="text-align:center;"><b>-4</b><br/><p style='font-size:0.8em'>(-2.0 per incident, maximum 2 incidents)</p></td>
</tr>
</table>

## Resources

To perform the data validation you will want to use some of the PHP provided functions:

- [is_numeric()](http://ca3.php.net/manual/en/function.is-numeric.php) to determine if a number was entered
- [isset()](http://ca3.php.net/manual/en/function.isset.php) to determine if the form data exists on the \$\_POST[ ] array
- [trim()](http://ca3.php.net/manual/en/function.trim.php) to remove any white space the user might have entered
- [define()](http://ca3.php.net/manual/en/function.define.php) defines a named constant.
- [abs()](http://ca3.php.net/manual/en/function.abs.php) to determine the absolute value of a number

Additionally students should check out the \$\_SERVER[ ] array in the manual, looking specifically at the `$_SERVER['REQUEST_URI']` or `$_SERVER['PHP_SELF']` as a way of submitting a form to itself, and `$_SERVER['REQUEST_METHOD']` to determine whether the page loads in "GET" mode (when the page first loads vs. "POST" which means the form has been submitted for processing.

## Submission

Publish your pages on the opentech server and submit the URL of your index page as a clickable link in the comment section of the "**Assignment 6**" drop box in DC Connect. If you do not submit something into DC Connect, your professor will assume you did not complete the assignment, and the late penalties will apply (including 0/20 if the link was not submitted within the **72 hours** late period). The onus is on you to ensure your lab instructor knows that you have work to be assessed.

::: warning
Do not mail or attach your files themselves into DC Connect. They must be published onto the opentech server.
:::
